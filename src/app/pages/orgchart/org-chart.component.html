<toast-messages/>
<p-fluid>
    <div class="flex h-[calc(100vh-8rem)] gap-5">

        <div class="rounded-[var(--content-border-radius)] w-80 p-1 bg-[var(--surface-overlay)] flex flex-col h-full shadow-sm border border-[var(--surface-border)]">

            <div class="p-5 pb-2 flex-none">
                <h3 class="text-lg font-bold mb-4 text-[var(--text-color)]">
                    Waiting For Positioning ({{ unassignedCount() }})
                </h3>

                <div class="relative w-full">
                    <input
                            pInputText
                            name="search"
                            type="text"
                            placeholder="Search name or code..."
                            (input)="onSearch($event)"
                            class="w-full pr-10"
                    />
                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-[var(--text-color)] opacity-60">
                        <i class="pi pi-search text-xs"></i>
                    </span>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-5 pt-2"
                 pDroppable
                 (onDrop)="dropToUnassigned()">

                <div class="flex flex-col gap-3">
                    @for (emp of filteredUnassignedList(); track emp.id) {
                        <div class="flex items-center gap-3 bg-[var(--surface-overlay)] border border-[var(--surface-border)] p-3 rounded-[var(--content-border-radius)] cursor-grab active:cursor-grabbing hover:border-[var(--primary-color)] hover:shadow-md transition-all"
                             pDraggable
                             (onDragStart)="onDragUnassigned(emp)"
                             (onDragEnd)="onDragEnd()">

                            <img [ngSrc]="emp.imageUrl || 'assets/defaultAvatar.png'"
                                 width="40"
                                 height="40"
                                 class="rounded-full object-cover"
                                 alt="avatar">

                            <div class="flex flex-col overflow-hidden">
                                <span class="text-sm font-bold text-[var(--text-color)] truncate">{{ emp.name }}</span>
                                <span class="text-[10px] text-[var(--text-color)] opacity-70 truncate">
                                    {{ emp.positionName || 'Waiting for positioning.' }}
                                </span>
                            </div>
                        </div>
                    } @empty {
                        <div class="text-center p-10 text-[var(--text-color)] opacity-50 text-xs">
                            No employees found.
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="flex-1 overflow-auto p-10 bg-[var(--surface-ground)] rounded-[var(--content-border-radius)] border border-[var(--surface-border)]">
            <div class="flex justify-center min-w-max">
                @for (root of nodes(); track root.data?.id) {
                    <app-org-node [node]="root"></app-org-node>
                }
            </div>
        </div>

    </div>
</p-fluid>